<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Tienda Éter</title>
    <meta name="description" content="Panel de administración para gestionar productos, pedidos y contenido de Tienda Éter">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    
    <!-- Critical CSS inline for performance -->
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.2s ease-in-out;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .admin-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--surface-color);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }
        
        .metric-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }
        
        .metric-content h3 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }
        
        .metric-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .dashboard-section {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .dashboard-section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 1rem 0;
        }
        
        @media (max-width: 768px) {
             .dashboard-content {
                 grid-template-columns: 1fr;
             }
         }
         
         .quick-actions {
             display: flex;
             gap: 1rem;
             margin-top: 2rem;
             flex-wrap: wrap;
         }
         
         .text-secondary {
             color: var(--text-secondary);
             font-style: italic;
         }
         
         .btn {
             padding: 0.75rem 1.5rem;
             border-radius: var(--radius-md);
             border: none;
             font-weight: 500;
             cursor: pointer;
             transition: var(--transition);
             display: inline-flex;
             align-items: center;
             gap: 0.5rem;
             text-decoration: none;
         }
         
         .btn-primary {
             background: var(--primary-color);
             color: white;
         }
         
         .btn-primary:hover {
             background: var(--primary-hover);
             transform: translateY(-1px);
         }
         
         .btn-secondary {
             background: var(--surface-color);
             color: var(--text-primary);
             border: 1px solid var(--border-color);
         }
         
         .btn-secondary:hover {
             background: var(--hover-color);
             transform: translateY(-1px);
         }
    </style>
    
    <!-- External stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/admin-consolidated.css">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen hidden" id="loadingScreen">
        <div class="spinner"></div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal-overlay" id="authModal" aria-hidden="true">
        <div class="modal auth-modal" role="dialog" aria-labelledby="authTitle" aria-modal="true">
            <div class="modal-header">
                <h2 id="authTitle">Acceso al Panel de Administración</h2>
            </div>
            <form class="auth-form" id="authForm" novalidate>
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" required autocomplete="username" aria-describedby="usernameError">
                    <div class="error-message" id="usernameError" role="alert"></div>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password" aria-describedby="passwordError">
                    <div class="error-message" id="passwordError" role="alert"></div>
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                    Iniciar Sesión
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div class="admin-container" id="adminApp" style="display: none;">
        <!-- Header -->
        <header class="admin-header" role="banner">
            <div class="header-content">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Alternar menú lateral">
                        <i class="fas fa-bars" aria-hidden="true"></i>
                    </button>
                    <div class="logo">
                        <i class="fas fa-store" aria-hidden="true"></i>
                        <span>Tienda Éter Admin</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn btn-ghost" id="viewSiteBtn" title="Ver sitio web">
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                        <span class="btn-text">Ver Sitio</span>
                    </button>
                    <div class="user-menu">
                        <button class="user-avatar" id="userMenuBtn" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-user-circle" aria-hidden="true"></i>
                            <span id="userName">Admin</span>
                            <i class="fas fa-chevron-down" aria-hidden="true"></i>
                        </button>
                        <div class="dropdown-menu" id="userDropdown" role="menu">
                            <a href="#" class="dropdown-item" role="menuitem">
                                <i class="fas fa-user" aria-hidden="true"></i>
                                Perfil
                            </a>
                            <a href="#" class="dropdown-item" role="menuitem">
                                <i class="fas fa-cog" aria-hidden="true"></i>
                                Configuración
                            </a>
                            <hr class="dropdown-divider">
                            <button class="dropdown-item" id="logoutBtn" role="menuitem">
                                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                                Cerrar Sesión
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar" role="navigation" aria-label="Navegación principal">
            <nav class="sidebar-nav">
                <ul class="nav-list" role="menubar">
                    <li class="nav-item" role="none">
                        <button class="nav-link active" data-tab="dashboard" role="menuitem" aria-current="page">
                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                            <span>Dashboard</span>
                        </button>
                    </li>
                    <li class="nav-item" role="none">
                        <button class="nav-link" data-tab="hero" role="menuitem">
                            <i class="fas fa-star" aria-hidden="true"></i>
                            <span>Sección Hero</span>
                        </button>
                    </li>
                    <li class="nav-item" role="none">
                        <button class="nav-link" data-tab="products" role="menuitem">
                            <i class="fas fa-box" aria-hidden="true"></i>
                            <span>Productos</span>
                            <span class="nav-badge" id="productsBadge">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="none">
                        <button class="nav-link" data-tab="orders" role="menuitem">
                            <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                            <span>Pedidos</span>
                            <span class="nav-badge" id="ordersBadge">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="none">
                        <button class="nav-link" data-tab="content" role="menuitem">
                            <i class="fas fa-edit" aria-hidden="true"></i>
                            <span>Contenido</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main" role="main">
            <!-- Dashboard Tab -->
            <section class="tab-panel active" id="dashboardPanel" role="tabpanel" aria-labelledby="dashboard">
                <div class="panel-header">
                    <h1>Dashboard</h1>
                    <p>Resumen general de tu tienda</p>
                </div>
                
                <div class="metrics-grid" id="metricsGrid">
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="metric-content">
                            <h3 id="totalProducts">0</h3>
                            <p>Total Productos</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="metric-content">
                            <h3 id="pendingOrders">0</h3>
                            <p>Pedidos Pendientes</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="metric-content">
                            <h3 id="monthlySales">$0</h3>
                            <p>Ventas del Mes</p>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-content">
                            <h3 id="newCustomers">0</h3>
                            <p>Nuevos Clientes</p>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="dashboard-section">
                        <h2>Últimos Pedidos</h2>
                        <div class="recent-orders" id="recentOrders">
                            <!-- Recent orders will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h2>Productos con Bajo Stock</h2>
                        <div class="low-stock-products" id="lowStockProducts">
                            <!-- Low stock products will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-content">
                    <div class="dashboard-section">
                        <h2><i class="fas fa-chart-line"></i> Actividad Reciente</h2>
                        <div id="recentActivity">
                            <p class="text-secondary">No hay actividad reciente</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h2><i class="fas fa-exclamation-triangle"></i> Alertas</h2>
                        <div id="systemAlerts">
                            <p class="text-secondary">No hay alertas</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="showSection('products')">
                        <i class="fas fa-plus"></i>
                        Agregar Producto
                    </button>
                    <button class="btn btn-secondary" onclick="showSection('orders')">
                        <i class="fas fa-list"></i>
                        Ver Pedidos
                    </button>
                    <button class="btn btn-secondary" onclick="showSection('hero')">
                        <i class="fas fa-image"></i>
                        Gestionar Hero
                    </button>
                </div>
            </section>

            <!-- Hero Section Tab -->
            <section class="tab-panel" id="heroPanel" role="tabpanel" aria-labelledby="hero">
                <div class="panel-header">
                    <h1>Gestionar Sección Hero</h1>
                    <p>Personaliza el contenido principal de la página de inicio</p>
                </div>
                
                <div class="hero-content" id="heroContent">
                    <!-- Hero management content will be loaded here -->
                </div>
            </section>

            <!-- Products Tab -->
            <section class="tab-panel" id="productsPanel" role="tabpanel" aria-labelledby="products">
                <div class="panel-header">
                    <h1>Gestionar Productos</h1>
                    <div class="panel-actions">
                        <button class="btn btn-primary" id="addProductBtn">
                            <i class="fas fa-plus" aria-hidden="true"></i>
                            Agregar Producto
                        </button>
                        <button class="btn btn-secondary" id="syncProductsBtn">
                            <i class="fas fa-sync" aria-hidden="true"></i>
                            Sincronizar
                        </button>
                        <button class="btn btn-warning" id="exportProductsBtn">
                            <i class="fas fa-download" aria-hidden="true"></i>
                            Exportar
                        </button>
                        <label class="btn btn-success" id="importProductsBtn">
                            <i class="fas fa-upload" aria-hidden="true"></i>
                            Importar XML
                            <input type="file" id="importXMLFile" accept=".xml" style="display: none;">
                        </label>
                    </div>
                </div>
                
                <div class="products-content" id="productsContent">
                    <!-- Products management content will be loaded here -->
                </div>
            </section>

            <!-- Orders Tab -->
            <section class="tab-panel" id="ordersPanel" role="tabpanel" aria-labelledby="orders">
                <div class="panel-header">
                    <h1>Gestionar Pedidos</h1>
                    <div class="panel-actions">
                        <select class="form-select" id="orderStatusFilter">
                            <option value="all">Todos los Estados</option>
                            <option value="pending">Pendientes</option>
                            <option value="confirmed">Confirmados</option>
                            <option value="shipped">Enviados</option>
                            <option value="delivered">Entregados</option>
                            <option value="cancelled">Cancelados</option>
                        </select>
                    </div>
                </div>
                
                <div class="orders-content" id="ordersContent">
                    <!-- Orders management content will be loaded here -->
                </div>
            </section>

            <!-- Content Tab -->
            <section class="tab-panel" id="contentPanel" role="tabpanel" aria-labelledby="content">
                <div class="panel-header">
                    <h1>Gestionar Contenido</h1>
                    <p>Edita el contenido general de la tienda</p>
                </div>
                
                <div class="content-management" id="contentManagement">
                    <!-- Content management will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer" aria-live="polite" aria-atomic="true">
        <!-- Notifications will be dynamically added here -->
    </div>

    <!-- Modal Container -->
    <div class="modal-container" id="modalContainer">
        <!-- Dynamic modals will be rendered here -->
    </div>

    <!-- JavaScript -->
    <script src="js/sync-manager.js"></script>
    <script src="js/product-crud.js"></script>
    <script src="js/admin.js"></script>

    <!-- Service Worker for caching -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered:', registration))
                    .catch(error => console.log('SW registration failed:', error));
            });
        }
    </script>
</body>
</html>